function extend(t,e){for(var r in e)t[r]||(t[r]=e[r])}function toggleX(t){return 40*t+40}function toggleY(t){return 40*t+20}function drow(t){t.ctx.canvas.onclick=null,t.ctx.fillRect(0,0,400,400),t.drowBgc(),t.drowText(t.textArr),t.move()}$(function(){var t=$("#cvs")[0].getContext("2d");new Chess(t)}),function(t){function e(t){this.ctx=t,this.drowBgc(),this.drowText(this.textArr),this.move()}extend(e.prototype,{textArr:{"red车1":["red","车",0,0],"red马1":["red","马",1,0],"red象1":["red","象",2,0],"red士1":["red","士",3,0],"red帅":["red","帅",4,0],"red士2":["red","士",5,0],"red象2":["red","象",6,0],"red马2":["red","马",7,0],"red车2":["red","车",8,0],"red炮1":["red","炮",1,2],"red炮2":["red","炮",7,2],"red兵1":["red","兵",0,3],"red兵2":["red","兵",2,3],"red兵3":["red","兵",4,3],"red兵4":["red","兵",6,3],"red兵5":["red","兵",8,3],"black车1":["black","車",0,9],"black马1":["black","马",1,9],"black象1":["black","象",2,9],"black士1":["black","士",3,9],"black帅":["black","将",4,9],"black士2":["black","士",5,9],"black象2":["black","象",6,9],"black马2":["black","马",7,9],"black车2":["black","車",8,9],"black炮1":["black","炮",1,7],"black炮2":["black","炮",7,7],"black兵1":["black","卒",0,6],"black兵2":["black","卒",2,6],"black兵3":["black","卒",4,6],"black兵4":["black","卒",6,6],"black兵5":["black","卒",8,6]},drowBgc:function(){for(var t=this.ctx,e=40,r=20,c=0;e<=360;c++)t.moveTo(e,r),t.lineTo(e,400-r),e+=40;t.stroke(),t.beginPath(),e=40,r=20;for(c=0;r<=380;c++)t.moveTo(e,r),t.lineTo(400-e,r),r+=40;t.stroke(),t.beginPath(),t.fillStyle="#dff0d8",t.fillRect(41,181,318,38),t.fill()},drowChess:function(t,e){this.ctx.arc(t,e,10,0,2*Math.PI),this.ctx.fillStyle="#dff0d8",this.ctx.strokeStyle="#000",this.ctx.fill(),this.ctx.stroke()},drowText:function(t){var e,r=this.ctx;for(e in t)r.beginPath(),this.drowChess(toggleX(t[e][2]),toggleY(t[e][3])),r.font="  15px Simsun,arial,sans-serif",r.strokeStyle=t[e][0],r.textAlign="center",r.textBaseline="middle",this.ctx.strokeText(t[e][1],toggleX(t[e][2]),toggleY(t[e][3]))},move:function(){var t=this;this.ctx.canvas.onclick=function(e){var r=t.textArr;for(every in r)r[every][2]==Math.round((e.offsetX-40)/40)&&r[every][3]==Math.round((e.offsetY-20)/40)&&(t.ctx.canvas.onclick=null,function(e){t.ctx.canvas.onclick=function(c){var a=Math.round((c.offsetX-40)/40),o=Math.round((c.offsetY-20)/40);for(var l in r)if(r[l][2]==a&&r[l][3]==o){if(t.textArr[e][0]==t.textArr[l][0])return alert("不能杀自己人"),drow(t),null;delete t.textArr[l],drow(t)}"车"!=r[e][1]&&"車"!=r[e][1]&&"兵"!=r[e][1]&&"卒"!=r[e][1]&&"炮"!=r[e][1]&&"将"!=r[e][1]&&"帅"!=r[e][1]||r[e][2]!=a&&r[e][3]!=o?"马"==r[e][1]&&Math.abs(r[e][2]-a)+Math.abs(r[e][3]-o)==3?(r[e][2]=a,r[e][3]=o,drow(t)):"象"==r[e][1]&&Math.abs(r[e][2]-a)+Math.abs(r[e][3]-a)==4?(r[e][2]=a,r[e][3]=a,drow(t)):"士"==r[e][1]&&Math.abs(r[e][2]-a)+Math.abs(r[e][3]-a)==2?(r[e][2]=a,r[e][3]=a,drow(t)):(drow(t),alert("注意规则")):(r[e][2]=a,r[e][3]=o,drow(t))}}(every))}}}),t.Chess=e}(window);